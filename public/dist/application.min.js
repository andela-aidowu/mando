"use strict";var ApplicationConfiguration=function(){var applicationModuleName="andonation",applicationModuleVendorDependencies=["ngResource","ngCookies","ngAnimate","ngTouch","ngSanitize","ui.router","ui.bootstrap","ui.utils"],registerModule=function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function($locationProvider){$locationProvider.hashPrefix("!")}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("campaign"),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("users"),angular.module("campaign").config(["$stateProvider","$sceDelegateProvider",function($stateProvider,$sceDelegateProvider){$stateProvider.state("addCampaign",{url:"/campaign/add",templateUrl:"modules/campaigns/views/addCampaign.client.view.html"}).state("viewCampaign",{url:"/campaign/:campaignid",templateUrl:"modules/campaigns/views/viewCampaign.client.view.html"}),$sceDelegateProvider.resourceUrlWhitelist(["**"])}]),angular.module("campaign").controller("addCampaignCtrl",["$scope","backendService","$location","Authentication",function($scope,backendService,$location,Authentication){$scope.authentication=Authentication,$scope.campaign={},$scope.minDate=moment().add(1,"days"),$scope.maxDate=moment().add(30,"days"),$scope.authentication.user||$location.path("/"),$scope.addCampaign=function(){var youtube=$scope.campaign.youtubeUrl.split("watch?v="),youtubeId=null;youtube.length>1&&(youtubeId=youtube[1]),backendService.addCampaign($scope.campaign).success(function(data){$location.path("/campaign/"+data._id)}).error(function(error){$scope.error=error})},$scope.validateYoutubeUrl=function(){var youtube=$scope.campaign.youtubeUrl.split("watch?v="),youtubeId=null;youtube.length>1&&(youtubeId=youtube[1]),backendService.checkYouTubeUrl(youtubeId).success(function(result){$scope.youtubeError="",console.log(result)}).error(function(error){$scope.youtubeError=error,console.log(error)})},$scope.open=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.opened=!0}}]),angular.module("campaign").controller("viewCampaignCtrl",["$scope","backendService","$location","Authentication","$stateParams",function($scope,backendService,$location,Authentication,$stateParams){$scope.authentication=Authentication,$scope.campaign={_id:$stateParams.campaignid},$scope.authentication.user||$location.path("/"),backendService.getCampaign($scope.campaign).success(function(data){var youtube=data.youtubeUrl.split("watch?v=");youtube.length>1&&(data.youtubeId="http://www.youtube.com/embed/"+youtube[1]),$scope.campaign=data,console.log(data)}).error(function(error){console.log(error)})}]),angular.module("campaign").factory("backendService",["$http",function($http){var addCampaign=function(campaignData){return $http.post("/campaign/add",campaignData)},getCampaign=function(campaignData){return $http.get("/campaign/"+campaignData._id)},checkYouTubeUrl=function(videoId){return $http.get("http://gdata.youtube.com/feeds/api/videos/"+videoId+"?alt=json")};return{addCampaign:addCampaign,getCampaign:getCampaign,checkYouTubeUrl:checkYouTubeUrl}}]),angular.module("core").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("home",{url:"/",templateUrl:"modules/core/views/home.client.view.html"})}]),angular.module("core").controller("HeaderController",["$scope","Authentication",function($scope,Authentication){$scope.authentication=Authentication}]),angular.module("core").controller("HomeController",["$scope","Authentication",function($scope,Authentication){$scope.authentication=Authentication}]),angular.module("users").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$q","$location","Authentication",function($q,$location,Authentication){return{responseError:function(rejection){switch(rejection.status){case 401:Authentication.user=null,$location.path("/");break;case 403:}return $q.reject(rejection)}}}])}]),angular.module("users").factory("Authentication",[function(){var _this=this;return _this._data={user:window.user},_this._data}]);